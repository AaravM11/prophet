// Prisma schema for Prophet user scaffolding: users, projects, runs, artifacts
// SQLite by default for local/dev. Override with DATABASE_URL for Postgres if desired.

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id        String    @id @default(cuid())
  address   String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  projects  Project[]

  @@index([address])
}

model Project {
  id          String    @id @default(cuid())
  userId      String
  name        String
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  runs Run[]

  @@index([userId, createdAt])
}

enum RunStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
}

model Run {
  id             String     @id @default(cuid())
  projectId      String
  status         RunStatus  @default(PENDING)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  // Artifacts and metadata
  contractSource String?
  prophetReport  Json?
  simulationLogs Json?      // Array of log entries or structured JSON
  metadata       Json?

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, createdAt])
  @@index([status, updatedAt])
}

